$(function(){function a(e){r.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y});n.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y});i.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}function f(e){return e.type==="g"?"#3182bd":"#c6dbef"}function l(e){var t;if(e.type==="g"){t=e.count/s.maxGenreSongs}else{t=e.count/s.maxArtistSongs}return t}function c(e){var t;if(e.type==="g"){t=e.plays/s.maxGenrePlays}else{t=e.plays/s.maxArtistPlays}return t}function h(e){var t=u(e);if(e.type==="g"){t=Math.max(t*40,4)}else{t=Math.max(t*25,2)}return t}function p(e,t){var n=u(e);return-n*1e3}function d(e,t){return o[e.index+","+t.index]||e.index==t.index}function v(e){return function(t){var s=e?.2:1;var o=h(t);n.style("stroke-opacity",function(e){thisOpac=d(t,e)?1:s;this.setAttribute("fill-opacity",thisOpac);return thisOpac});r.style("stroke-opacity",function(e){return e.source===t||e.target===t?1:s});i.select("text.label").remove();n.select("title").remove();if(e){i.filter(function(e){return d(e,t)}).append("svg:text").attr("y",function(e){return e==t?o+10+"px":"5px"}).style("fill","#f00").attr("text-anchor","middle").attr("class","label").text(function(e){return e!==t?e.name.substr(0,16):""});n.filter(function(e){return e===t}).append("title").text(function(e){return e.name+" / Songs: "+e.count+" / Plays: "+e.plays})}}}function y(){m.nodes(s.nodes).links(s.links).start();r=g.selectAll("link.link").data(s.links);r.enter().append("svg:line").attr("class","link").attr("source",function(e){return e.source}).attr("target",function(e){return e.target});r.exit().remove();n=g.selectAll("circle.node").data(s.nodes);n.enter().append("svg:circle").attr("class","node").attr("id",function(e){return e.type+e.id}).style("fill",f).attr("r",h).on("mouseover",v(true)).on("mouseout",v(false)).call(m.drag);n.exit().remove();o={};s.links.forEach(function(e){o[e.source.index+","+e.target.index]=1;o[e.target.index+","+e.source.index]=1});i=g.selectAll("g.labelParent").data(s.nodes);i.enter().append("svg:g").attr("class","labelParent");i.exit().remove();n.each(v(false));$("#songsBtn").click(function(){m.stop();u=l;g.selectAll("circle.node").attr("r",h);m.charge(p).start();$(this).addClass("active");$("#playsBtn").removeClass("active");return false});$("#playsBtn").click(function(){m.stop();u=c;g.selectAll("circle.node").attr("r",h);m.charge(p).start();$(this).addClass("active");$("#songsBtn").removeClass("active");return false})}var e=900,t=500,n,r,i,s,o,u;u=l;var m=d3.layout.force().on("tick",a).size([e,t]).linkDistance(30).charge(p);var g=d3.select("#chart").append("svg:svg").attr("width",e).attr("height",t);d3.json("js/music-data.json",function(e){s=e;y()})})